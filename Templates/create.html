{% extends "base.html" %}
{% block content %}
    <div class="container">
        <h1 style="text-align:center;">Eine Firma erstellen</h1>
    <form id="firm_form">
        <div class="form-group">
            <label>Firmenname</label>
            <input class="form-control" id="typeahead" type="text" name="name" placeholder="Firmenname" required>
        </div>
        <div class="form-group">
            <label>Straße</label>
            <input class="form-control" type="text" name="strasse_hnr" placeholder="Straße Hausnummer" required>
        </div>
        <div class="form-group">
            <label>Adresszusatz</label>
            <input class="form-control" type="text" name="adresszusatz" placeholder="Adresszusatz" required>
        </div>
        <div class="form-group">
            <label>PLZ</label>
            <input class="form-control" type="text" name="plz" placeholder="PLZ" required>
        </div>
        <div class="form-group">
            <label>Ort</label>
            <input class="form-control" type="text" name="ort" placeholder="Ort" required>
        </div>
        <div class="form-group">
            <label>Website</label>
            <input class="form-control" type="text" name="website" placeholder="Website" required>
        </div>
        <div class="form-group">
            <label>Erfassungsdatum</label>
            <input class="form-control" type="date" name="erfassungsdatum" placeholder="datum" required>
        </div>
        <div class="form-group">
            <label>Land</label>
            <input class="form-control" type="text" name="land" placeholder="Land" required>
        </div>
        <div class="form-group">
            <label>Branche</label>
            <select name="branche" class="form-control">
                <option>Kommunikation</option>
                <option>Telekom</option>
                <option>Software</option>
                <option>Multimedia</option>
                <option>Luftfahrt</option>
                <option>Verteidigung</option>
                <option>Webdesign</option>
                <option>WLAN</option>
                <option>IT-Dienstleistung</option>
                <option>Netzwerkmanagement</option>
                <option>Digitalfunk</option>
                <option>Verlag</option>
                <option>N/A</option>
            </select>
        </div>
    </form>
    <h2>Ansprechpartner</h2>
    <form class="ansprechpartner_form checked">
        <div class="form-group">
            <label>Name</label><br>
            <input class="form-control" type="text" name="name" placeholder="Name" required>
        </div>
        <div class="form-group">
            <label>Anrede</label><br>
            <input type="radio" name="anrede" value="Herr"> Herr
            <input type="radio" name="anrede" value="Frau"> Frau
        </div>
        <div class="form-group">
            <label>Titel</label><br>
            <input class="form-control typeahead_title" type="text" name="titel" placeholder="Titel">
        </div>
        <div class="form-group">
            <label>Funktion</label><br>
            <input class="form-control" type="text" name="funktion" placeholder="Funktion">
        </div>
        <div class="form-group">
            <label>Email</label><br>
            <input class="form-control" type="email" name="email" placeholder="Email" required>
        </div>
        <div class="form-group">
            <label>Fax</label><br>
            <input class="form-control" type="text" name="fax" placeholder="Fax">
        </div>
        <div class="form-group">
            <label>Telefon</label><br>
            <input class="form-control" type="text" name="telefon" placeholder="Telefon" required>
        </div>
    </form>
    <input type="checkbox" id="ansprechpartner1_checkbox">Ansprechpartner hinzufügen
    <h2>Ansprechpartner</h2>
    <form class="ansprechpartner_form disabled" id="ansprechpartner_form_1">
        <div class="form-group">
            <label>Name</label><br>
            <input class="form-control" type="text" name="name" placeholder="Name" required>
        </div>
        <div class="form-group">
            <label>Anrede</label><br>
            <input type="radio" name="anrede" value="Herr"> Herr
            <input type="radio" name="anrede" value="Frau"> Frau
        </div>
        <div class="form-group">
            <label>Titel</label><br>
            <input class="form-control typeahead_title" type="text" name="titel" placeholder="Titel">
        </div>
        <div class="form-group">
            <label>Funktion</label><br>
            <input class="form-control" type="text" name="funktion" placeholder="Funktion">
        </div>
        <div class="form-group">
            <label>Email</label><br>
            <input class="form-control" type="email" name="email" placeholder="Email" required>
        </div>
        <div class="form-group">
            <label>Fax</label><br>
            <input class="form-control" type="text" name="fax" placeholder="Fax">
        </div>
        <div class="form-group">
            <label>Telefon</label><br>
            <input class="form-control" type="text" name="telefon" placeholder="Telefon" required>
        </div>
    </form>
    <input type="checkbox" id="ansprechpartner2_checkbox">Ansprechpartner hinzufügen
    <h2>Ansprechpartner</h2>
    <form class="ansprechpartner_form disabled" id="ansprechpartner_form_2">
        <div class="form-group">
            <label>Name</label><br>
            <input class="form-control" type="text" name="name" placeholder="Name" required>
        </div>
        <div class="form-group">
            <label>Anrede</label><br>
            <input type="radio" name="anrede" value="Herr"> Herr
            <input type="radio" name="anrede" value="Frau"> Frau
        </div>
        <div class="form-group">
            <label>Titel</label><br>
            <input class="form-control typeahead_title" type="text" name="titel" placeholder="Titel">
        </div>
        <div class="form-group">
            <label>Funktion</label><br>
            <input class="form-control" type="text" name="funktion" placeholder="Funktion">
        </div>
        <div class="form-group">
            <label>Email</label><br>
            <input class="form-control" type="email" name="email" placeholder="Email" required>
        </div>
        <div class="form-group">
            <label>Fax</label><br>
            <input class="form-control" type="text" name="fax" placeholder="Fax">
        </div>
        <div class="form-group">
            <label>Telefon</label><br>
            <input class="form-control" type="text" name="telefon" placeholder="Telefon" required>
        </div>
    </form>
    <button id="submit_create" class="btn btn-primary">Erstellen</button>
    <button id="cancel_submit" class="btn btn-danger" onclick="if(!confirm('Möchten Sie wirklick abbrechen?'))return false;else{window.location.replace('/')}">Abbrechen</button>
    </div>

<script type="application/javascript">
    $(function(){
        disable_ansprechpartner_form();

        $('input:checkbox#ansprechpartner1_checkbox').change(
        function(){
            if ($(this).is(':checked')) {
                $('form#ansprechpartner_form_1').removeClass('disabled').addClass('checked');
                enable_ansprechpartner_form();
            }else{
                $('form#ansprechpartner_form_1').removeClass('checked').addClass('disabled');
                disable_ansprechpartner_form();
            }
        })

        $('input:checkbox#ansprechpartner2_checkbox').change(
        function(){
            if ($(this).is(':checked')) {
                $('form#ansprechpartner_form_2').removeClass('disabled').addClass('checked');
                enable_ansprechpartner_form();
            }else{
                $('form#ansprechpartner_form_2').removeClass('checked').addClass('disabled');
                disable_ansprechpartner_form();
            }
        })

        $('button#submit_create').on('click',function(){
            var result = parse_firm_obj_from_form();
            if(result.flag){
                $.ajax({
                    type: "POST",
                    url: "/firm/create",
                    data: JSON.stringify(result.firm_obj),
                    contentType: 'application/json',
                    dataType: 'json'
                    }).always(function(data){
                    if(data.status == 200)
                        window.location.replace("/?create="+result.firm_obj.name);
                    else if(data.status == 500)
                        alert('Etwas ist schiefgelaufen, bitte versuchen Sie später erneut.')
                });
            }else{
                alert("Bitte prüfen Sie das Formular, es gibt Fehler.");
            }
        });
    });

</script>
<script src="{{ url_for('static', filename='js/parse_firm_object_from_form.js') }}"></script>
<script src="{{ url_for('static', filename='js/typeahead_utils.js') }}"></script>
{% endblock %}
{% extends "base.html" %}
{% block content %}
    <div class="container">
        <h1 style="text-align:center;">Eine vorhandene Firma bearbeiten</h1>
    <label>Firma auswählen</label>
    <select id="firm_name" class="form-control">
        <option>A firm</option>
        <option>Another firm</option>
    </select>
    <form id="firm_form">
        <div class="form-group">
            <label>Firmenname</label>
            <input class="form-control" type="text" name="name" placeholder="Firmenname" required>
        </div>
        <div class="form-group">
            <label>Straße</label>
            <input class="form-control" type="text" name="strasse_hnr" placeholder="Straße Hausnummer" required>
        </div>
        <div class="form-group">
            <label>Adresszusatz</label>
            <input class="form-control" type="text" name="adresszusatz" placeholder="Adresszusatz" required>
        </div>
        <div class="form-group">
            <label>PLZ</label>
            <input class="form-control" type="text" name="plz" placeholder="PLZ" required>
        </div>
        <div class="form-group">
            <label>Ort</label>
            <input class="form-control" type="text" name="ort" placeholder="Ort" required>
        </div>
        <div class="form-group">
            <label>Website</label>
            <input class="form-control" type="text" name="website" placeholder="Website" required>
        </div>
        <div class="form-group">
            <label>Erfassungsdatum</label>
            <input class="form-control" type="text" name="erfassungsdatum" placeholder="datum" required>
        </div>
        <div class="form-group">
            <label>Land</label>
            <input class="form-control" type="text" name="land" placeholder="Land" required>
        </div>
        <div class="form-group">
            <label>Branche</label>
            <select name="branche" class="form-control">
                <option>Kommunikation</option>
                <option>Telekom</option>
                <option>Software</option>
                <option>N/A</option>
            </select>
        </div>
    </form>
    <h2>Ansprechpartner</h2>
    <form class="ansprechpartner_form">
        <div class="form-group">
            <label>Name</label><br>
            <input class="form-control" type="text" name="name" placeholder="Name" required>
        </div>
        <div class="form-group">
            <label>Anrede</label><br>
            <input type="radio" name="anrede" value="Herr"> Herr
            <input type="radio" name="anrede" value="Frau"> Frau
        </div>
        <div class="form-group">
            <label>Titel</label><br>
            <input class="form-control" type="text" name="titel" placeholder="Titel">
        </div>
        <div class="form-group">
            <label>Funktion</label><br>
            <input class="form-control" type="text" name="funktion" placeholder="Funktion">
        </div>
        <div class="form-group">
            <label>Email</label><br>
            <input class="form-control" type="email" name="email" placeholder="Email" required>
        </div>
        <div class="form-group">
            <label>Fax</label><br>
            <input class="form-control" type="text" name="fax" placeholder="Fax">
        </div>
        <div class="form-group">
            <label>Telefon</label><br>
            <input class="form-control" type="text" name="telefon" placeholder="Telefon" required>
        </div>
    </form>
    <h2>Ansprechpartner</h2>
    <form class="ansprechpartner_form">
        <div class="form-group">
            <label>Name</label><br>
            <input class="form-control" type="text" name="name" placeholder="Name" required>
        </div>
        <div class="form-group">
            <label>Anrede</label><br>
            <input type="radio" name="anrede" value="Herr"> Herr
            <input type="radio" name="anrede" value="Frau"> Frau
        </div>
        <div class="form-group">
            <label>Titel</label><br>
            <input class="form-control" type="text" name="titel" placeholder="Titel">
        </div>
        <div class="form-group">
            <label>Funktion</label><br>
            <input class="form-control" type="text" name="funktion" placeholder="Funktion">
        </div>
        <div class="form-group">
            <label>Email</label><br>
            <input class="form-control" type="email" name="email" placeholder="Email" required>
        </div>
        <div class="form-group">
            <label>Fax</label><br>
            <input class="form-control" type="text" name="fax" placeholder="Fax">
        </div>
        <div class="form-group">
            <label>Telefon</label><br>
            <input class="form-control" type="text" name="telefon" placeholder="Telefon" required>
        </div>
    </form>
    <h2>Ansprechpartner</h2>
    <form class="ansprechpartner_form">
        <div class="form-group">
            <label>Name</label><br>
            <input class="form-control" type="text" name="name" placeholder="Name" required>
        </div>
        <div class="form-group">
            <label>Anrede</label><br>
            <input type="radio" name="anrede" value="Herr"> Herr
            <input type="radio" name="anrede" value="Frau"> Frau
        </div>
        <div class="form-group">
            <label>Titel</label><br>
            <input class="form-control" type="text" name="titel" placeholder="Titel">
        </div>
        <div class="form-group">
            <label>Funktion</label><br>
            <input class="form-control" type="text" name="funktion" placeholder="Funktion">
        </div>
        <div class="form-group">
            <label>Email</label><br>
            <input class="form-control" type="email" name="email" placeholder="Email" required>
        </div>
        <div class="form-group">
            <label>Fax</label><br>
            <input class="form-control" type="text" name="fax" placeholder="Fax">
        </div>
        <div class="form-group">
            <label>Telefon</label><br>
            <input class="form-control" type="text" name="telefon" placeholder="Telefon" required>
        </div>
    </form>
    <button id="submit_edit" class="btn btn-primary">Bearbeiten</button>
    <button id="cancel_submit" class="btn btn-danger" onclick="if(!confirm('Möchten Sie wirklick abbrechen?'))return false;else{window.location.replace('/')}">Abbrechen</button>
    </div>
<script src="{{ url_for('static', filename='js/populate.js') }}"></script>
<script src="{{ url_for('static', filename='js/typeahead.js') }}"></script>
<script>
    var firm_obj = {};
    var ansprechpartner_list = [];
    var firms_list = [];
    var firm_form = $("form#firm_form");
    var list_of_ans_forms = $('.ansprechpartner_form');

    $.get( "/firms", function( firms ) {
        firms_list = Object.assign(firms);
        $('select#firm_name').empty();
        $.each(firms,function(index,firm){
            $('select#firm_name').append($('<option>').text(firm.name).attr('value',index));
        });
    });

    $('select#firm_name').on('change', function (e) {
        firm_form[0].reset();
        $.each(list_of_ans_forms,function(){
           $(this)[0].reset();
        });
        var value_selected = this.value;
        $.each(firms_list,function(index,firm){
            if(index == value_selected){
                for(var i=0; i<firm.ansprechpartner.length; i++){
                    $(list_of_ans_forms[i]).populate(firm.ansprechpartner[i]);
                }
                var temp_firm = jQuery.extend({}, firm);
                delete temp_firm.ansprechpartner;
                firm_form.populate(temp_firm);
            }
        });
    });

    $('button#submit_edit').on('click',function(){
        firm_obj = parse_firm_obj_from_form();
        $.ajax({
            type: "PUT",
            url: "/firm/edit",
            data: JSON.stringify(firm_obj),
            contentType: 'application/json',
            dataType: 'json'
        }).always(function(data){
            window.location.replace("/?edit=true");
        });
    });
</script>
<script src="{{ url_for('static', filename='js/parse_firm_object_from_form.js') }}"></script>
{% endblock %}

